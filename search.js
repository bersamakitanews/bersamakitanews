const FramebarSearch=({url='https://www.detik.com/search/searchall',params={}}={})=>{const onLoad=async(stateRequest)=>{if(stateRequest===false){CookiesSearch().onLoad();stateRequest=true;} _topKeywordSearch();} const _topKeywordSearch=async()=>{let topKeyword=[];const storageName='top_keyword';if(window.localStorage){topKeyword=localStorage.getItem(storageName);} topKeyword=topKeyword?JSON.parse(topKeyword):[];let currDate=new Date().toLocaleString("en-US",{timeZone:"Asia/Jakarta"});currDate=new Date(currDate).getTime();if(currDate<topKeyword.expired){return _appendTopKeyword(topKeyword.value);} topKeyword=await _getTopKeywordSearch();topKeyword=topKeyword?topKeyword.body.topKeywordSearch:[];if(topKeyword.length==0){return _appendTopKeyword(topKeyword);} topKeyword=topKeyword.map((item)=>{return item.keyword;});if(window.localStorage){localStorage.setItem(storageName,JSON.stringify({expired:currDate+(5*60*1000),value:topKeyword}));} _appendTopKeyword(topKeyword);} const _getTopKeywordSearch=async()=>{const __dtma=CookiesSearch().getCookies('__dtma',false);const uniqueVisitor=__dtma?`?uniqueVisitor=${__dtma}`:'';const headers=new Headers();headers.append('Content-Type','application/json');try{const response=await fetch(`https://explore-api.detik.com/trending${uniqueVisitor}`);const data=await response.json();return data;}catch(error){console.log(error);return null;}} const _appendTopKeyword=(data=[])=>{const elTopKeyword=document.getElementById('top-keyword-search');const qs=Object.entries(params).reduce((acc,[key,value])=>{acc=`${acc}&${key}=${value}`;return acc;},'');let content='';for(let i=0;i<data.length;i++){content+=` <li> <a href="${url}?query=${data[i]}${qs}" dtr-evt="search bar" dtr-sec="trending search" dtr-act="trending search" onclick="_pt(this)" dtr-idx="${i + 1 + '$##$' + data[i]}" dtr-ttl="${data[i]}"><span class="font-bold">#${i+1} </span>${data[i]}</a>`;if(i<3){content+=`<span class="icon-right"> <img src="${ asset_common }/images/icon-chart.webp" width="18" height="18" alt=""> </span>`;} content+=`</li>`;} elTopKeyword.innerHTML=content;} return{onLoad:onLoad};} const CookiesSearch=({url='https://www.detik.com/search/searchall',cookieName='last_search',params={},}={})=>{const onLoad=()=>{lastCookieValue=_getCookies(cookieName);_appendLastSearch(lastCookieValue);} const onDelete=(index,e)=>{let lastCookieValue=_getCookies(cookieName);_pt(e) lastCookieValue.splice(index,1);const cookiesData={name:cookieName,value:lastCookieValue,expires:30,} _setCookies(cookiesData);lastCookieValue=_getCookies(cookieName);_appendLastSearch(lastCookieValue);} const _saveLastSearch=(querySearch='')=>{if(querySearch==''){return _appendLastSearch(_getCookies(cookieName));} let lastCookieValue=_getCookies(cookieName);lastCookieValue=lastCookieValue.filter(item=>item.toLowerCase()!==querySearch.toLowerCase());lastCookieValue.unshift(querySearch);if(lastCookieValue.length>3){lastCookieValue=lastCookieValue.slice(0,3);} const cookiesData={name:cookieName,value:lastCookieValue,expires:30,} _setCookies(cookiesData);} const _appendLastSearch=(data)=>{const elLastSearch=document.getElementById('last-search');const qs=Object.entries(params).reduce((acc,[key,value])=>{acc=`${acc}&${key}=${value}`;return acc;},'');let content='';for(let i=0;i<data.length;i++){content+=` <li> <a href="${url}?query=${data[i].toLowerCase()}${qs}" dtr-evt="search bar" dtr-sec="recent search" dtr-act="recent search" onclick="_pt(this)" dtr-idx=${i + 1} dtr-ttl="${data[i]}"><i class="icon icon-back-in-time"></i> ${data[i]}</a> <span class="icon-right clear-list" onclick="CookiesSearch().onDelete(${i}, this)" dtr-evt="search bar" dtr-sec="delete" dtr-act="delete" itp-cookie-last-search="${data[i]}"> <img src="${ asset_common }/images/framebar/icon-clear.webp" width="15" height="15" alt=""> </span> </li>`;} elLastSearch.innerHTML=content;} const _setCookies=(data)=>{return document.cookie=data.name+"="+JSON.stringify(data.value)+";"+data.expires+";domain=.detik.com;path=/";} const _getCookies=(cookieName,parse=true)=>{const cookies=document.cookie.split(';');for(let i=0;i<cookies.length;i++){const cookie=cookies[i].trim();if(cookie.startsWith(cookieName+'=')){if(parse===true){return JSON.parse(cookie.replace(cookieName+'=',''));}else{return cookie.replace(cookieName+'=','');}}} return[];} return{onLoad:onLoad,onDelete:onDelete,getCookies:_getCookies,setCookies:_setCookies,saveLastSearch:_saveLastSearch};}
